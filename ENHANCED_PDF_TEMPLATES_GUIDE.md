# ðŸ§¾ Enhanced PDF Templates Guide

## Overview

This guide covers the enhanced PDF templates for **Invoices** and **Payslips** with comprehensive Jamaica-friendly compliance features and professional layouts.

---

## ðŸ“‹ Enhanced Invoice Template Features

### **âœ… Legal Compliance (Jamaica-Friendly)**
- **TRN (Taxpayer Registration Number)** display
- **GCT Registration Number** and rate (15%)
- **Business Registration** information
- **Company legal details** section

### **âœ… Professional Layout**
- **Company logo** and branding
- **Enhanced customer information** with phone/email
- **Purchase Order (PO) number** tracking
- **Prepared by** field for internal tracking
- **Payment terms** and bank details
- **Notes section** for additional information

### **âœ… Enhanced Items Table**
- **Description, Quantity, Rate, Tax, Amount** columns
- **Automatic tax calculations** (GCT @ 15%)
- **Professional formatting** with proper spacing
- **Currency formatting** (JMD, USD, etc.)

### **âœ… Payment Information**
- **Bank details** section
- **Payment terms** display
- **Thank you message** and branding
- **Generated by Bizabode CRM** footer

---

## ðŸ’° Enhanced Payslip Template Features

### **âœ… Comprehensive Employee Information**
- **Full name, position, department**
- **Employee ID** and **TRN** (if available)
- **Pay period** and **payment date**
- **Company information** with logo

### **âœ… Detailed Earnings Section**
- **Basic salary** breakdown
- **Overtime pay** calculations
- **Commissions and bonuses**
- **Allowances** (travel, housing, phone, etc.)
- **Gross pay** total

### **âœ… Jamaica Tax Deductions**
- **Income Tax / PAYE** calculations
- **NIS (National Insurance Scheme)** contributions
- **NHT (National Housing Trust)** deductions
- **Education Tax** contributions
- **Health and pension** deductions
- **Other deductions** (advances, union dues)

### **âœ… Professional Summary**
- **Gross pay** total
- **Total deductions** breakdown
- **Net pay** calculation
- **Payment method** and bank details
- **Legal notice** and branding

---

## ðŸš€ Usage Examples

### **Enhanced Invoice Generation**

```typescript
import { generateEnhancedInvoicePDF } from '@/lib/utils/enhanced-pdf-generator'

// Sample invoice data
const invoice = {
  invoiceNumber: 'INV-2025-0001',
  invoiceDate: new Date(),
  dueDate: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000), // 30 days
  customerName: 'John Smith',
  customerAddress: '123 Main St, Kingston, Jamaica',
  customerEmail: 'john@example.com',
  customerPhone: '+1-876-555-0123',
  purchaseOrderNumber: 'PO-2025-001',
  preparedBy: 'Sales Team',
  paymentTerms: 'Net 30 days',
  notes: 'Thank you for your business!',
  items: [
    {
      description: 'Professional Services',
      quantity: 10,
      unitPrice: 100.00,
      tax: 0.15, // 15% GCT
      total: 1000.00
    },
    {
      description: 'Consulting Hours',
      quantity: 5,
      unitPrice: 150.00,
      tax: 0.15,
      total: 750.00
    }
  ],
  subtotal: 1750.00,
  tax: 262.50, // 15% GCT
  total: 2012.50
}

// Sample company data with legal compliance
const company = {
  name: 'Bizabode Solutions Ltd',
  address: '456 Business Ave, Kingston, Jamaica',
  phone: '+1-876-555-0100',
  email: 'info@bizabode.com',
  logo: '/path/to/logo.png',
  trn: '123456789', // Jamaica TRN
  gctNumber: 'GCT-2025-001',
  businessRegistration: 'BR-2025-001',
  bankDetails: {
    bankName: 'National Commercial Bank',
    accountNumber: '1234567890',
    routingNumber: 'NCBJJMXXX'
  }
}

// Generate enhanced invoice PDF
try {
  const pdfBuffer = await generateEnhancedInvoicePDF(invoice, company)
  // Use pdfBuffer for download or storage
} catch (error) {
  console.error('Invoice generation failed:', error)
}
```

### **Enhanced Payslip Generation**

```typescript
import { generateEnhancedPayslipPDF } from '@/lib/utils/enhanced-pdf-generator'

// Sample payroll data
const payroll = {
  payPeriod: {
    startDate: new Date('2025-01-01'),
    endDate: new Date('2025-01-31')
  },
  paymentDate: new Date('2025-02-05'),
  employeeId: {
    firstName: 'John',
    lastName: 'Smith',
    employeeId: 'EMP001',
    position: 'Sales Manager',
    department: 'Sales',
    trn: '987654321'
  },
  items: [
    // Earnings
    { type: 'earning', description: 'Basic Salary', amount: 5000.00 },
    { type: 'earning', description: 'Overtime Pay', amount: 500.00 },
    { type: 'earning', description: 'Commission', amount: 300.00 },
    { type: 'earning', description: 'Travel Allowance', amount: 200.00 },
    
    // Deductions
    { type: 'deduction', description: 'Income Tax (PAYE)', amount: 750.00 },
    { type: 'deduction', description: 'NIS Contribution', amount: 150.00 },
    { type: 'deduction', description: 'NHT Contribution', amount: 100.00 },
    { type: 'deduction', description: 'Education Tax', amount: 50.00 },
    { type: 'deduction', description: 'Health Insurance', amount: 75.00 }
  ],
  grossPay: 6000.00,
  deductions: 1125.00,
  netPay: 4875.00,
  paymentMethod: 'Bank Transfer',
  bankDetails: {
    accountNumber: '9876543210',
    bankName: 'Scotiabank Jamaica'
  }
}

// Sample company data
const company = {
  name: 'Bizabode Solutions Ltd',
  address: '456 Business Ave, Kingston, Jamaica',
  phone: '+1-876-555-0100',
  email: 'hr@bizabode.com',
  logo: '/path/to/logo.png'
}

// Generate enhanced payslip PDF
try {
  const pdfBuffer = await generateEnhancedPayslipPDF(payroll, company)
  // Use pdfBuffer for download or storage
} catch (error) {
  console.error('Payslip generation failed:', error)
}
```

---

## ðŸ”§ API Route Integration

### **Enhanced Invoice API Route**

```typescript
// app/api/invoices/[id]/download-enhanced-pdf/route.ts
import { NextRequest } from 'next/server'
import { generateEnhancedInvoicePDF } from '@/lib/utils/enhanced-pdf-generator'
import { authenticateToken } from '@/lib/middleware/auth'

export async function GET(
  request: NextRequest,
  { params }: { params: { id: string } }
) {
  try {
    const authResult = await authenticateToken(request)
    if (!authResult.authenticated) {
      return new Response('Unauthorized', { status: 401 })
    }

    const invoice = await Invoice.findOne({
      _id: params.id,
      companyId: authResult.user.companyId
    }).populate('customerId')

    const company = await Company.findById(authResult.user.companyId)

    const pdfBuffer = await generateEnhancedInvoicePDF(invoice, company)

    return new Response(pdfBuffer, {
      headers: {
        'Content-Type': 'application/pdf',
        'Content-Disposition': `attachment; filename="invoice-${invoice.invoiceNumber}.pdf"`
      }
    })
  } catch (error) {
    console.error('Enhanced invoice PDF generation failed:', error)
    return new Response('PDF generation failed', { status: 500 })
  }
}
```

### **Enhanced Payslip API Route**

```typescript
// app/api/payroll/[id]/download-enhanced-payslip/route.ts
import { NextRequest } from 'next/server'
import { generateEnhancedPayslipPDF } from '@/lib/utils/enhanced-pdf-generator'
import { authenticateToken } from '@/lib/middleware/auth'

export async function GET(
  request: NextRequest,
  { params }: { params: { id: string } }
) {
  try {
    const authResult = await authenticateToken(request)
    if (!authResult.authenticated) {
      return new Response('Unauthorized', { status: 401 })
    }

    const payroll = await Payroll.findOne({
      _id: params.id,
      companyId: authResult.user.companyId
    }).populate('employeeId')

    const company = await Company.findById(authResult.user.companyId)

    const pdfBuffer = await generateEnhancedPayslipPDF(payroll, company)

    return new Response(pdfBuffer, {
      headers: {
        'Content-Type': 'application/pdf',
        'Content-Disposition': `attachment; filename="payslip-${payroll.employeeId.employeeId}-${new Date().toISOString().split('T')[0]}.pdf"`
      }
    })
  } catch (error) {
    console.error('Enhanced payslip PDF generation failed:', error)
    return new Response('PDF generation failed', { status: 500 })
  }
}
```

---

## ðŸ“Š Data Structure Requirements

### **Company Object (Enhanced)**
```typescript
interface EnhancedCompany {
  name: string
  address: string
  phone: string
  email: string
  logo?: string
  trn?: string                    // Jamaica TRN
  gctNumber?: string              // GCT Registration
  businessRegistration?: string   // Business Registration
  bankDetails?: {
    bankName: string
    accountNumber: string
    routingNumber: string
  }
}
```

### **Invoice Object (Enhanced)**
```typescript
interface EnhancedInvoice {
  invoiceNumber: string
  invoiceDate: Date
  dueDate: Date
  customerName: string
  customerAddress?: string
  customerEmail?: string
  customerPhone?: string
  purchaseOrderNumber?: string
  preparedBy?: string
  paymentTerms?: string
  notes?: string
  items: Array<{
    description: string
    quantity: number
    unitPrice: number
    tax: number        // Tax rate (0.15 for 15% GCT)
    total: number
  }>
  subtotal: number
  tax: number
  total: number
}
```

### **Payroll Object (Enhanced)**
```typescript
interface EnhancedPayroll {
  payPeriod: {
    startDate: Date
    endDate: Date
  }
  paymentDate: Date
  employeeId: {
    firstName: string
    lastName: string
    employeeId: string
    position: string
    department: string
    trn?: string
  }
  items: Array<{
    type: 'earning' | 'deduction'
    description: string
    amount: number
  }>
  grossPay: number
  deductions: number
  netPay: number
  paymentMethod?: string
  bankDetails?: {
    accountNumber: string
    bankName: string
  }
}
```

---

## ðŸŽ¯ Quick Checklist

### **Invoice Checklist**
- âœ… Company logo and branding
- âœ… Legal compliance (TRN, GCT, Business Registration)
- âœ… Customer information with contact details
- âœ… Purchase order and prepared by fields
- âœ… Enhanced items table with tax calculations
- âœ… Payment information and bank details
- âœ… Professional footer with branding

### **Payslip Checklist**
- âœ… Employee information with TRN
- âœ… Pay period and payment date
- âœ… Comprehensive earnings breakdown
- âœ… Jamaica tax deductions (PAYE, NIS, NHT, Education Tax)
- âœ… Net pay calculation
- âœ… Payment method and bank details
- âœ… Legal notice and branding

---

## ðŸš€ Next Steps

1. **Test the enhanced templates** with your existing data
2. **Update your API routes** to use the enhanced generators
3. **Add legal compliance fields** to your company and employee models
4. **Customize the templates** further based on your specific needs
5. **Deploy and test** in your production environment

The enhanced templates provide professional, Jamaica-compliant PDF generation that will significantly improve your business documentation! ðŸŽ‰

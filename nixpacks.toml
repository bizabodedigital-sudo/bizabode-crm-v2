[phases.setup]
nixPkgs = ["nodejs_20", "pnpm"]
aptPkgs = ["curl", "wget"]

[phases.install]
cmds = ["pnpm install --frozen-lockfile"]

[phases.build]
# Copy build-time env so Next.js doesn't crash during static analysis
cmds = ["cp .env.build .env.local", "pnpm run build"]

[start]
cmd = "pnpm run start"

[variables]
NODE_ENV = "production"
PORT = "3000"